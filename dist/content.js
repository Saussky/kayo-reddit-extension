(()=>{"use strict";function e(e,t){return e.filter((e=>t.includes(e)))}function t(e){return e.toLowerCase().split(/[-_!1]/).filter((e=>"vs"!==e&&!e.startsWith("https://")&&"fixture"!==e&&"match"!==e&&"thread"!==e&&"round"!==e))}const o=e=>!!e.toLowerCase().includes("afl")||(console.log('The URL does not contain "afl".'),!1),n=(o,n)=>{let r="";for(const l of n)e(o,t(l)).length>=2&&(r=l);return r};function r(){const e=document.querySelector(".sc-01-lower-controls__LowerControlsContainer-sc-1ec7mdq-0");e&&(e.style.display="flex",e.style.position="fixed",e.style.bottom="0",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.zIndex="1000",e.style.opacity="1",e.style.transition="opacity 0.3s ease-in-out")}function l(){const e=document.querySelector(".sc-01-lower-controls__LowerControlsContainer-sc-1ec7mdq-0");e&&(e.style.opacity="0",setTimeout((()=>{e.style.display="none"}),300))}var i=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const s=JSON.parse('{"AFL":"other","fitzroy4":"other","fitzroy7":"other","fitzroy14":"other","fitzroy15":"other","bears9":"other","bears8":"other","bears13":"other","bears12":"other","VFL":"other","victoria":"other","SANFL":"other","southaustralia":"other","WAFL":"other","westernaustralia":"other","tasmania":"other","allies":"other","australia":"other","newzealand":"other","ireland":"other","UK":"other","USA":"other","canada":"other","boxingroo":"other","Leprechaun":"other","university":"other","adelaide":"adelaide","adelaide2":"adelaide","adelaide3":"adelaide","adelaide4":"adelaide","adelaide6":"adelaide","adelaide10":"adelaide","adelaide11":"adelaide","adelaide12":"adelaide","ADLWEG":"adelaide","brisbane":"brisbane","brisbane2":"brisbane","brisbane3":"brisbane","brisbane6":"brisbane","brisbane10":"brisbane","brisbane11":"brisbane","BRIWEG":"brisbane","BRIBW":"brisbane","carlton":"carlton","carlton2":"carlton","carlton3":"carlton","carlton4":"carlton","carlton6":"carlton","carlton10":"carlton","carlton11":"carlton","carlton12":"carlton","CARWEG":"carlton","collingwood":"collingwood","collingwood2":"collingwood","collingwood3":"collingwood","collingwood6":"collingwood","collingwood10":"collingwood","collingwood11":"collingwood","collingwood12":"collingwood","COLWEG":"collingwood","COLBW":"collingwood","essendon":"essendon","essendon2":"essendon","essendon3":"essendon","essendon6":"essendon","essendon10":"essendon","essendon11":"essendon","essendon12":"essendon","ESSWEG":"essendon","AFLW-2022-EssendonW":"essendon","fremantle":"fremantle","fremantle2":"fremantle","fremantle3":"fremantle","fremantle10":"fremantle","fremantle11":"fremantle","fremantle12":"fremantle","fremantle13":"fremantle","fremantle14":"fremantle","fremantle15":"fremantle","FREBW":"fremantle","geelong":"geelong","geelong2":"geelong","geelong3":"geelong","geelong6":"geelong","geelong7":"geelong","geelong10":"geelong","geelong11":"geelong","geelong12":"geelong","GEEWEG":"geelong","AFLW-GeelongW":"geelong","GEEBW":"geelong","goldcoast":"goldcoast","goldcoast2":"goldcoast","goldcoast10":"goldcoast","goldcoast11":"goldcoast","goldcoast12":"goldcoast","AFLW-Gold-CoastW":"goldcoast","gws":"gws","gws2":"gws","gws10":"gws","gws11":"gws","gws12":"gws","hawthorn":"hawthorn","hawthorn2":"hawthorn","hawthorn3":"hawthorn","hawthorn6":"hawthorn","hawthorn7":"hawthorn","hawthorn10":"hawthorn","hawthorn11":"hawthorn","hawthorn12":"hawthorn","HAWWEG":"hawthorn","AFLW-2022-HawthornW":"hawthorn","melbourne":"melbourne","melbourne2":"melbourne","melbourne3":"melbourne","melbourne4":"melbourne","melbourne5":"melbourne","melbourne6":"melbourne","melbourne7":"melbourne","melbourne8":"melbourne","melbourne10":"melbourne","melbourne11":"melbourne","melbourne12":"melbourne","MELWEG":"melbourne","MELBW":"melbourne","northmelbourne":"northmelbourne","northmelbourne2":"northmelbourne","northmelbourne3":"northmelbourne","northmelbourne4":"northmelbourne","northmelbourne6":"northmelbourne","northmelbourne7":"northmelbourne","northmelbourne10":"northmelbourne","northmelbourne11":"northmelbourne","northmelbourne12":"northmelbourne","NORWEG":"northmelbourne","AFLW-NorthW":"northmelbourne","portadelaide":"portadelaide","portadelaide2":"portadelaide","portadelaide3":"portadelaide","portadelaide10":"portadelaide","portadelaide11":"portadelaide","portadelaide12":"portadelaide","portadelaide13":"portadelaide","portadelaide14":"portadelaide","PORWEG":"portadelaide","AFLW-2022-PortW":"portadelaide","richmond":"richmond","richmond2":"richmond","richmond3":"richmond","richmond6":"richmond","richmond7":"richmond","richmond10":"richmond","richmond11":"richmond","richmond12":"richmond","RICWEG":"richmond","AFLW-RichmondW":"richmond","RICBW":"richmond","stkilda":"stkilda","stkilda2":"stkilda","stkilda6":"stkilda","stkilda7":"stkilda","stkilda10":"stkilda","stkilda11":"stkilda","stkilda12":"stkilda","stkilda13":"stkilda","STKWEG":"stkilda","AFLW-StKildaW":"stkilda","sydney":"sydney","sydney3":"sydney","sydney6":"sydney","sydney7":"sydney","sydney10":"sydney","sydney11":"sydney","sydney12":"sydney","sydney13":"sydney","SYDWEG":"sydney","SYDBW":"sydney","AFLW-2022-SydneyW":"sydney","sydney2":"sydney","westcoast":"westcoast","westcoast2":"westcoast","westcoast3":"westcoast","westcoast4":"westcoast","westcoast6":"westcoast","westcoast10":"westcoast","westcoast11":"westcoast","westcoast12":"westcoast","westcoast13":"westcoast","WCEWEG":"westcoast","AFLW-West-CoastW":"westcoast","westernbulldogs":"westernbulldogs","westernbulldogs2":"westernbulldogs","westernbulldogs3":"westernbulldogs","westernbulldogs4":"westernbulldogs","westernbulldogs6":"westernbulldogs","westernbulldogs7":"westernbulldogs","westernbulldogs10":"westernbulldogs","westernbulldogs11":"westernbulldogs","westernbulldogs12":"westernbulldogs","WBDWEG":"westernbulldogs","WBDBW":"westernbulldogs"}'),a=JSON.parse('{"adelaide":{"direction":"horizontal","colours":["blue","red","yellow"]},"brisbane":{"direction":"horizontal","colours":["maroon","gold","blue"]},"carlton":{"direction":"horizontal","colours":["navy","navy"]},"collingwood":{"direction":"vertical","colours":["black","white"]},"essendon":{"direction":"diagonal","colours":["red","black"]},"fremantle":{"direction":"horizontal","colours":["purple","white"]},"geelong":{"direction":"vertical","colours":["white","darkblue"]},"goldcoast":{"direction":"diagonal","colours":["red","yellow"]},"gws":{"direction":"horizontal","colours":["orange","orange"]},"hawthorn":{"direction":"vertical","colours":["brown","yellow"]},"melbourne":{"direction":"horizontal","colours":["red","blue"]},"northmelbourne":{"direction":"vertical","colours":["blue","white"]},"portadelaide":{"direction":"vertical","colours":["teal","black","white"]},"richmond":{"direction":"diagonal","colours":["yellow","black"]},"stkilda":{"direction":"vertical","colours":["red","white","black"]},"sydney":{"direction":"horizontal","colours":["red","white"]},"westcoast":{"direction":"vertical","colours":["yellow","blue","yellow"]},"westernbulldogs":{"direction":"horizontal","colours":["white","blue","red"]}}'),d=s;var c=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};function u(e,t,o){return c(this,void 0,void 0,(function*(){console.log("loaded sidebar");const n=t.contentDocument.querySelector("#comments-container"),r=function(e){const t=document.createElement("div");return t.className="ticker-wrap",t.style.cssText="\n      position: absolute;\n      bottom: 0;\n      color: white;\n      width: 100%;\n      height: 30px;\n      overflow: hidden;\n      background-color: rgba(0,0,0,0.6);\n      box-sizing: content-box;\n      display: flex;\n      align-items: center;\n      white-space: nowrap;\n      z-index: 999;\n      display: none; // Initially hidden\n    ",e.parentElement.appendChild(t),t}(e);!function(e,t){document.addEventListener("fullscreenchange",(()=>{document.fullscreenElement?(e.style.display="none",t.style.display="flex",Array.from(e.children).forEach((e=>function(e,t,o){let n=null;const r=t.clientWidth+e.clientWidth,l=o=>{null===n&&(n=o);const i=o-n,s=r*i/15e3;e.style.transform=`translateX(-${s}px)`,i<15e3?requestAnimationFrame(l):setTimeout((()=>{t.removeChild(e)}),2e3)};requestAnimationFrame(l)}(e,t)))):(e.style.display="block",t.style.display="none")}))}(n,r);let l=[];const s=()=>c(this,void 0,void 0,(function*(){const e=yield function(e){return i(this,void 0,void 0,(function*(){return yield new Promise((t=>{chrome.runtime.sendMessage({action:"getRedditComments",data:{threadLink:e}},(e=>{t(e)}))}))}))}(o),t=e.filter((e=>!l.some((t=>t.id===e.id))));t.forEach((e=>{const t=function(e){const t=document.createElement("div");t.className="comment";const o=document.createElement("div");o.style.cssText="\n    display: flex;\n    align-items: center;\n  ";const n=document.createElement("h3");n.innerText=e.username;const r=d[e.flair];if(r)try{const e=function(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","20"),t.setAttribute("height","20");const o=document.createElementNS("http://www.w3.org/2000/svg","defs"),n=document.createElementNS("http://www.w3.org/2000/svg","clipPath");n.setAttribute("id","clipCircle");const r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx","10"),r.setAttribute("cy","10"),r.setAttribute("r","10"),n.appendChild(r),o.appendChild(n),t.appendChild(o);const l=e.colours,i=e.direction;if("horizontal"===i){const e=20/l.length;l.forEach(((o,n)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("y",String(n*e)),r.setAttribute("width","20"),r.setAttribute("height",String(e)),r.setAttribute("fill",o),r.setAttribute("clip-path","url(#clipCircle)"),t.appendChild(r)}))}else if("vertical"===i){const e=20/3;for(let o=0;o<3;o++){const n=l[o%l.length],r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",String(o*e)),r.setAttribute("width",String(e)),r.setAttribute("height","20"),r.setAttribute("fill",n),r.setAttribute("clip-path","url(#clipCircle)"),t.appendChild(r)}}else if("diagonal"===i){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x","-18"),e.setAttribute("y","5"),e.setAttribute("width","88"),e.setAttribute("height","8"),e.setAttribute("transform","rotate(-45 10 10)"),e.setAttribute("fill",l[0]),e.setAttribute("clip-path","url(#clipCircle)"),t.appendChild(e);const o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width","20"),o.setAttribute("height","20"),o.setAttribute("fill",l[1]),o.setAttribute("clip-path","url(#clipCircle)"),t.insertBefore(o,e)}return t}(a[r]);o.appendChild(e)}catch(e){console.error("Error while creating SVG:",e)}o.appendChild(n),t.appendChild(o);const l=document.createElement("p");return l.textContent=e.comment,t.appendChild(l),t}(e);n.insertBefore(t,n.firstChild)})),l.push(...t)}));yield s(),setInterval(s,1e3)}))}function h(e,t){var o;const n=document.getElementById("kayo-reddit-sidebar");n&&document.removeChild(n);const i=document.createElement("iframe");i.id="kayo-reddit-sidebar",i.src=chrome.runtime.getURL("sidebar.html"),i.style.cssText="\n      border: none;\n      height: 100%;\n      position: absolute;\n      width: 335px;\n      top: 0;\n      z-index: 99999;\n    ",i.onload=()=>{u(e,i,t)};const s=document.querySelector(".player__VideoBackingCard-sc-ocmrm0-1");s?(function(e,t){e.style.setProperty("left","calc(0% - 4vw)","important"),e.style.setProperty("transform","translate(0%, -50%)","important"),e.style.setProperty("width","calc(100% - 190px)","important"),e.style.setProperty("height","100vh");const o=e.getBoundingClientRect().width;t.style.left=`calc(${o}px - 5vw)`}(s,i),null===(o=s.parentElement)||void 0===o||o.appendChild(i),function(e){let t;e.addEventListener("mouseover",(()=>{r()})),e.addEventListener("mouseleave",(()=>{setTimeout(l,1500)})),e.addEventListener("mousemove",(()=>{t&&clearTimeout(t),t=setTimeout(l,3e3),r()}))}(s)):console.log("Can't find video player element")}var m=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};let w=null;function g(){return m(this,void 0,void 0,(function*(){const e=document.body;let r=!1;new MutationObserver(((e,l)=>m(this,void 0,void 0,(function*(){if(r)return;const i=window.location.href;for(const s of e)if("childList"===s.type){if(!o(i))break;const e=t(i);let s=yield new Promise((e=>{chrome.runtime.sendMessage({action:"getRedditThreads"},(t=>{e(t)}))}));s=["r/AFL/comments/1299rcy/match_thread_melbourne_vs_sydney_round_3/"];const a=n(e,s);if(!a){console.log("Couldn't find matching reddit thread");break}if(console.log("matching thread",a),w=document.querySelector("video"),w)return h(w,a),r=!0,l.disconnect(),void(w=null)}})))).observe(e,{childList:!0,subtree:!0})}))}g(),g()})();